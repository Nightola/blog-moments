<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨æ€ | ï½¥âœ¦ Nightola-227 FM âœ¦ï½¥</title>
    <style>
        /* ä¿æŒä½ åŸæœ‰çš„åŸºç¡€ CSS ä¸å˜ */
        :root { --width: 720px; --text-color: #444; --link-color: #3273dc; }
        body { font-family: sans-serif; margin: auto; padding: 20px; max-width: var(--width); background-image: url("https://pic1.imgdb.cn/item/6946acea29a616e528622615.jpg"); background-attachment: fixed; background-size: cover; }
        main { background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(10px); padding: 25px; border-radius: 16px; min-height: 400px; }
        nav { margin-bottom: 20px; display: flex; gap: 10px; }
        nav a { text-decoration: none; color: var(--text-color); font-weight: bold; }

        /* åŠ¨æ€å¡ç‰‡åŸºç¡€ */
        .moment-card { padding: 20px 0; border-bottom: 1px solid rgba(0, 0, 0, 0.05); display: flex; gap: 12px; }
        .moment-avatar-wrap { flex-shrink: 0; }
        .item-avatar { width: 42px; height: 42px; border-radius: 6px; object-fit: cover; }
        .moment-body { flex-grow: 1; display: flex; flex-direction: column; gap: 8px; }
        .moment-author { font-weight: 700; color: #576b95; }
        .moment-text { font-size: 0.95rem; line-height: 1.5; color: var(--text-color); white-space: pre-wrap; }
        .moment-date { font-size: 0.75rem; color: #b2b2b2; }

        /* ğŸ¬ è§†é¢‘æ ·å¼ */
        .moment-video { width: 100%; max-width: 450px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); }

        /* ğŸµ éŸ³ä¹å¡ç‰‡æ ·å¼ */
        .music-player { 
            display: flex; align-items: center; gap: 12px; 
            background: rgba(255,255,255,0.2); padding: 10px; 
            border-radius: 8px; max-width: 400px; border: 1px solid rgba(255,255,255,0.2);
        }
        .music-info { flex: 1; }
        .music-title { font-weight: bold; font-size: 0.9rem; margin-bottom: 2px; }
        .music-artist { font-size: 0.8rem; color: #666; }
        audio { height: 30px; width: 100%; margin-top: 5px; }

        /* ğŸ–¼ï¸ ç›¸å†Œ/ä¹å®«æ ¼æ ·å¼ */
        .moment-gallery { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; max-width: 450px; }
        .moment-gallery img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 4px; cursor: pointer; }
        .moment-gallery.single { display: block; }
        .moment-gallery.single img { max-width: 200px; max-height: 200px; width: auto; aspect-ratio: auto; }
        
        /* ç›¸å†Œæ¨¡å¼ç‰¹æ®Šæ ‡è®° */
        .album-tag { font-size: 0.7rem; background: var(--link-color); color: white; padding: 2px 6px; border-radius: 4px; margin-left: 5px; vertical-align: middle; }

        /* æŒ‰é’®ä¸é®ç½© */
        .filter-btn { cursor: pointer; border: none; background: rgba(255,255,255,0.3); padding: 4px 12px; border-radius: 15px; font-size: 0.8rem; }
        .filter-btn.active { background: var(--link-color); color: white; }
        #image-viewer { display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); justify-content: center; align-items: center; }
        #viewer-img { max-width: 90%; max-height: 90%; border-radius: 4px; }
    </style>
</head>
<body>

<header>
    <h1>ï½¥âœ¦ Nightola-227 FM âœ¦ï½¥</h1>
    <nav>
        <a href="https://nightola.bearblog.dev/">é¦–é¡µ</a>
        <a href="#" style="color: var(--link-color)">åŠ¨æ€</a>
    </nav>
</header>

<main>
    <div id="filterNav" style="margin-bottom: 20px; display: flex; gap: 8px; flex-wrap: wrap;">
        <button class="filter-btn active" id="btn-all">å…¨éƒ¨</button>
    </div>

    <div id="momentsList">
        <p style="text-align: center; color: #888;">æ­£åœ¨åŠ è½½åŠ¨æ€...</p>
    </div>
</main>

<div id="image-viewer" onclick="this.style.display='none'">
    <img id="viewer-img" src="">
</div>

<script>
    const list = document.getElementById('momentsList');
    const nav = document.getElementById('filterNav');
    const viewer = document.getElementById('image-viewer');
    const viewerImg = document.getElementById('viewer-img');

    fetch('data.json')
        .then(res => res.json())
        .then(data => {
            renderList(data, 'all');
            initNav(data);
        })
        .catch(err => {
            list.innerHTML = `<p style="color:red">æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ JSON æ ¼å¼ã€‚</p>`;
        });

    function initNav(allData) {
        const years = [...new Set(allData.map(d => d.year))].sort().reverse();
        const allBtn = document.getElementById('btn-all');
        allBtn.onclick = () => { setActive(allBtn); renderList(allData, 'all'); };

        years.forEach(year => {
            const btn = document.createElement('button');
            btn.className = 'filter-btn';
            btn.innerText = year;
            btn.onclick = () => { setActive(btn); renderList(allData, year); };
            nav.appendChild(btn);
        });
    }

    function setActive(btn) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function renderList(allData, filterYear) {
        list.innerHTML = '';
        const filtered = filterYear === 'all' ? allData : allData.filter(d => d.year === filterYear);
        
        if(filtered.length === 0) {
            list.innerHTML = '<p style="text-align:center; color:#888;">æš‚æ— å†…å®¹</p>';
            return;
        }

        filtered.forEach(item => {
            let mediaHtml = '';

            // 1. åˆ¤æ–­æ˜¯å¦æ˜¯è§†é¢‘
            if (item.video) {
                mediaHtml = `<video class="moment-video" controls src="${item.video}" preload="metadata"></video>`;
            } 
            // 2. åˆ¤æ–­æ˜¯å¦æ˜¯éŸ³ä¹
            else if (item.music) {
                mediaHtml = `
                    <div class="music-player">
                        <div class="music-info">
                            <div class="music-title">${item.music.title}</div>
                            <div class="music-artist">${item.music.artist}</div>
                            <audio controls src="${item.music.url}"></audio>
                        </div>
                    </div>`;
            }
            // 3. å¤„ç†å›¾ç‰‡/ç›¸å†Œ
            else if (item.imgs && item.imgs.length > 0) {
                const isSingle = item.imgs.length === 1;
                const imgList = item.imgs.map(src => 
                    `<img src="${src}" loading="lazy" onclick="event.stopPropagation(); openViewer('${src}')">`
                ).join('');
                mediaHtml = `<div class="moment-gallery ${isSingle ? 'single' : ''}">${imgList}</div>`;
            }

            const card = document.createElement('div');
            card.className = 'moment-card';
            card.innerHTML = `
                <div class="moment-avatar-wrap">
                    <img src="images/avatar.jpg" class="item-avatar">
                </div>
                <div class="moment-body">
                    <div class="moment-author">äºšç¦»è§£æ˜Ÿ ${item.album ? '<span class="album-tag">ç›¸å†Œ</span>' : ''}</div>
                    <div class="moment-text">${item.text}</div>
                    ${mediaHtml}
                    <div class="moment-date">${item.date}</div>
                </div>
            `;
            list.appendChild(card);
        });
    }

    function openViewer(src) {
        viewerImg.src = src;
        viewer.style.display = 'flex';
    }
</script>
</body>
</html>
